{"ast":null,"code":"var _jsxFileName = \"/Users/Julie/near/digital-war/frontend/src/App.js\";\nimport \"./App.css\";\nimport React from 'react'; // import BN from 'bn.js';\n\nimport * as nearAPI from 'near-api-js';\nimport Big from 'big.js';\nconst TGas = Big(10).pow(12);\nconst BoatOfGas = Big(200).mul(TGas); // const ContractName = 'dev-1629962930296-20948195726082';\n// const ContractName = 'dev-1630033758756-26263481745179';\n\nconst ContractName = 'dev-1630146349634-18193940589410';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      connected: false,\n      signedIn: false,\n      accountId: null,\n      digitals: [],\n      all_digitals: [],\n      own_digital: \"\",\n      target_digital: \"\",\n      levelup_target: \"\"\n    };\n    this._digitalRefreshTimer = null;\n    this.handleLevelUpTargetChange = this.handleLevelUpTargetChange.bind(this);\n    this.levelupSubmit = this.levelupSubmit.bind(this);\n    this.handleOwnChange = this.handleOwnChange.bind(this);\n    this.handleTargetChange = this.handleTargetChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n\n    this._initNear().then(() => {\n      this.setState({\n        connected: true,\n        signedIn: !!this._accountId,\n        accountId: this._accountId\n      });\n    });\n  }\n\n  componentDidMount() {}\n\n  async query_digitals() {\n    let digitals = await this._contract.get_digitals({\n      accountId: this._accountId\n    });\n    let all_digitals = await this._contract.get_all_digitals({\n      accountId: this._accountId\n    });\n    this.setState({\n      digitals: digitals,\n      all_digitals: all_digitals\n    });\n  }\n\n  async refreshAccountStats() {\n    let digitals = await this._contract.get_digitals({\n      accountId: this._accountId\n    });\n    let all_digitals = await this._contract.get_all_digitals({\n      accountId: this._accountId\n    });\n\n    if (this._digitalRefreshTimer) {\n      clearInterval(this._digitalRefreshTimer);\n      this._digitalRefreshTimer = null;\n    }\n\n    this.setState({\n      digitals: digitals,\n      all_digitals: all_digitals\n    }); // this._digitalRefreshTimer = setInterval(() => {\n    //   this.query_digitals();\n    // }, 100);\n  }\n\n  async _initNear() {\n    const nearConfig = {\n      networkId: 'default',\n      nodeUrl: 'https://rpc.testnet.near.org',\n      contractName: ContractName,\n      walletUrl: 'https://wallet.testnet.near.org'\n    };\n    const keyStore = new nearAPI.keyStores.BrowserLocalStorageKeyStore();\n    const near = await nearAPI.connect(Object.assign({\n      deps: {\n        keyStore\n      }\n    }, nearConfig));\n    this._keyStore = keyStore;\n    this._nearConfig = nearConfig;\n    this._near = near;\n    this._walletConnection = new nearAPI.WalletConnection(near, ContractName);\n    this._accountId = this._walletConnection.getAccountId();\n    this._account = this._walletConnection.account();\n    this._contract = new nearAPI.Contract(this._account, ContractName, {\n      viewMethods: ['get_digitals', 'next_digital', 'get_all_digitals'],\n      changeMethods: ['add_first', 'pk', 'levelup']\n    });\n\n    if (this._accountId) {\n      await this.refreshAccountStats();\n    }\n  }\n\n  async requestSignIn() {\n    const appTitle = 'Digital War';\n    await this._walletConnection.requestSignIn(ContractName, appTitle);\n  }\n\n  async logOut() {\n    this._walletConnection.signOut();\n\n    this._accountId = null;\n    this.setState({\n      signedIn: !!this._accountId,\n      accountId: this._accountId\n    });\n  }\n\n  async addFirst() {\n    let res = await this._contract.add_first();\n    alert(res);\n    window.location.reload();\n  }\n\n  async pk_action() {\n    let res = await this._contract.pk({\n      own_digital: parseInt(this.state.own_digital, 10),\n      target_digital: parseInt(this.state.target_digital, 10)\n    }); // alert('own_digital: ' + this.state.own_digital  + ',target_digital: ' + this.state.target_digital);\n\n    alert(res);\n    window.location.reload();\n  }\n\n  handleOwnChange(event) {\n    this.setState({\n      own_digital: event.target.value\n    });\n  }\n\n  handleTargetChange(event) {\n    this.setState({\n      target_digital: event.target.value\n    });\n  }\n\n  handleSubmit(event) {\n    this.pk_action();\n    event.preventDefault();\n  }\n\n  async action_levelup() {\n    let res = await this._contract.levelup({\n      digital: parseInt(this.state.levelup_target, 10)\n    }, BoatOfGas.toFixed(0), Big(10000000000).mul(TGas).toFixed(0)); // alert('own_digital: ' + this.state.own_digital  + ',target_digital: ' + this.state.target_digital);\n\n    alert(res);\n    window.location.reload();\n  }\n\n  handleLevelUpTargetChange(event) {\n    this.setState({\n      levelup_target: event.target.value\n    });\n  }\n\n  levelupSubmit(event) {\n    this.action_levelup();\n    event.preventDefault();\n  }\n\n  render() {\n    const content = !this.state.connected ? /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 7\n      }\n    }, \"Connecting... \", /*#__PURE__*/React.createElement(\"span\", {\n      className: \"spinner-grow spinner-grow-sm\",\n      role: \"status\",\n      \"aria-hidden\": \"true\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 26\n      }\n    })) : this.state.signedIn ? /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"float-right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-outline-secondary\",\n      onClick: () => this.logOut(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 11\n      }\n    }, \"Log out\")), /*#__PURE__*/React.createElement(\"h4\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 9\n      }\n    }, \"Hello, \", /*#__PURE__*/React.createElement(\"span\", {\n      className: \"font-weight-bold\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 20\n      }\n    }, this.state.accountId), \"!\"), /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: this.levelupSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 11\n      }\n    }, \" digital: \", /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      style: {\n        marginLeft: \"74px\"\n      },\n      value: this.state.levelup_target,\n      onChange: event => {\n        this.handleLevelUpTargetChange(event);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 28\n      }\n    }), \" \"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 182\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"submit\",\n      value: \"levelup\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: this.handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 11\n      }\n    }, \" challenger: \", /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      style: {\n        marginLeft: \"44px\"\n      },\n      value: this.state.own_digital,\n      onChange: event => {\n        this.handleOwnChange(event);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 31\n      }\n    }), \" \"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 172\n      }\n    }), /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 11\n      }\n    }, \" challenge target: \", /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      value: this.state.target_digital,\n      onChange: event => {\n        this.handleTargetChange(event);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 37\n      }\n    }), \" \"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 156\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"submit\",\n      value: \"challenge\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 9\n      }\n    }, \"Your digitals:\", /*#__PURE__*/React.createElement(\"ul\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 11\n      }\n    }, this.state.digitals.length !== 0 ? this.state.digitals.map(value => /*#__PURE__*/React.createElement(\"li\", {\n      key: value,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 49\n      }\n    }, \" \", value)) : /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-primary\",\n      onClick: () => this.addFirst(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 16\n      }\n    }, \"Get first digital\"))), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 9\n      }\n    }, \"Digital Pool:\", /*#__PURE__*/React.createElement(\"ul\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 11\n      }\n    }, this.state.all_digitals.length !== 0 ? this.state.all_digitals.map(value => /*#__PURE__*/React.createElement(\"li\", {\n      style: {\n        whiteSpace: \"pre\"\n      },\n      key: value.digital,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 53\n      }\n    }, \" Digital\\uFF1A\", value.digital, \"       Owner\\uFF1A\", value.owner, \"       Level\\uFF1A\", value.level)) : /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 16\n      }\n    }, \"\\u6682\\u65E0\")))) : /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        marginBottom: \"10px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-primary\",\n      onClick: () => this.requestSignIn(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }\n    }, \"Log in with NEAR Wallet\"));\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"px-5\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 9\n      }\n    }, \"Digital War\"), content);\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/Julie/near/digital-war/frontend/src/App.js"],"names":["React","nearAPI","Big","TGas","pow","BoatOfGas","mul","ContractName","App","Component","constructor","props","state","connected","signedIn","accountId","digitals","all_digitals","own_digital","target_digital","levelup_target","_digitalRefreshTimer","handleLevelUpTargetChange","bind","levelupSubmit","handleOwnChange","handleTargetChange","handleSubmit","_initNear","then","setState","_accountId","componentDidMount","query_digitals","_contract","get_digitals","get_all_digitals","refreshAccountStats","clearInterval","nearConfig","networkId","nodeUrl","contractName","walletUrl","keyStore","keyStores","BrowserLocalStorageKeyStore","near","connect","Object","assign","deps","_keyStore","_nearConfig","_near","_walletConnection","WalletConnection","getAccountId","_account","account","Contract","viewMethods","changeMethods","requestSignIn","appTitle","logOut","signOut","addFirst","res","add_first","alert","window","location","reload","pk_action","pk","parseInt","event","target","value","preventDefault","action_levelup","levelup","digital","toFixed","render","content","marginLeft","length","map","whiteSpace","owner","level","marginBottom"],"mappings":"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","sourcesContent":["import \"./App.css\";\nimport React from 'react';\n// import BN from 'bn.js';\nimport * as nearAPI from 'near-api-js'\nimport Big from 'big.js';\n\nconst TGas = Big(10).pow(12);\nconst BoatOfGas = Big(200).mul(TGas);\n\n// const ContractName = 'dev-1629962930296-20948195726082';\n// const ContractName = 'dev-1630033758756-26263481745179';\nconst ContractName = 'dev-1630146349634-18193940589410';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      connected: false,\n      signedIn: false,\n      accountId: null,\n      digitals: [],\n      all_digitals: [],\n      own_digital: \"\",\n      target_digital: \"\",\n      levelup_target:\"\"\n    };\n\n    this._digitalRefreshTimer = null;\n\n\n    this.handleLevelUpTargetChange = this.handleLevelUpTargetChange.bind(this);\n    this.levelupSubmit = this.levelupSubmit.bind(this);\n\n    this.handleOwnChange = this.handleOwnChange.bind(this);\n    this.handleTargetChange = this.handleTargetChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n\n    this._initNear().then(() => {\n      this.setState({\n        connected: true,\n        signedIn: !!this._accountId,\n        accountId: this._accountId,\n      });\n    });\n  }\n\n  componentDidMount() {\n  }\n\n\n  async query_digitals() {\n    let digitals = await this._contract.get_digitals({ accountId: this._accountId })\n    let all_digitals = await this._contract.get_all_digitals({ accountId: this._accountId })\n    this.setState({\n      digitals: digitals,\n      all_digitals: all_digitals,\n    })\n  }\n\n  async refreshAccountStats() {\n    let digitals = await this._contract.get_digitals({ accountId: this._accountId });\n    let all_digitals = await this._contract.get_all_digitals({ accountId: this._accountId })\n    if (this._digitalRefreshTimer) {\n      clearInterval(this._digitalRefreshTimer);\n      this._digitalRefreshTimer = null;\n    }\n\n    this.setState({\n      digitals: digitals,\n      all_digitals: all_digitals,\n    });\n\n    // this._digitalRefreshTimer = setInterval(() => {\n    //   this.query_digitals();\n    // }, 100);\n  }\n\n\n\n  async _initNear() {\n    const nearConfig = {\n      networkId: 'default',\n      nodeUrl: 'https://rpc.testnet.near.org',\n      contractName: ContractName,\n      walletUrl: 'https://wallet.testnet.near.org',\n    };\n    const keyStore = new nearAPI.keyStores.BrowserLocalStorageKeyStore();\n    const near = await nearAPI.connect(Object.assign({ deps: { keyStore } }, nearConfig));\n    this._keyStore = keyStore;\n    this._nearConfig = nearConfig;\n    this._near = near;\n\n    this._walletConnection = new nearAPI.WalletConnection(near, ContractName);\n    this._accountId = this._walletConnection.getAccountId();\n\n    this._account = this._walletConnection.account();\n    this._contract = new nearAPI.Contract(this._account, ContractName, {\n      viewMethods: ['get_digitals', 'next_digital', 'get_all_digitals'],\n      changeMethods: ['add_first', 'pk', 'levelup'],\n    });\n    if (this._accountId) {\n      await this.refreshAccountStats();\n    }\n  }\n\n\n  async requestSignIn() {\n    const appTitle = 'Digital War';\n    await this._walletConnection.requestSignIn(\n      ContractName,\n      appTitle\n    )\n  }\n\n  async logOut() {\n    this._walletConnection.signOut();\n    this._accountId = null;\n    this.setState({\n      signedIn: !!this._accountId,\n      accountId: this._accountId,\n    })\n  }\n\n  async addFirst() {\n    let res = await this._contract.add_first();\n    alert(res);\n    window.location.reload()\n  }\n\n  async pk_action(){\n    let res = await this._contract.pk({own_digital: parseInt(this.state.own_digital, 10), target_digital: parseInt(this.state.target_digital, 10)})\n    // alert('own_digital: ' + this.state.own_digital  + ',target_digital: ' + this.state.target_digital);\n    alert(res)\n    window.location.reload()\n  }\n\n  handleOwnChange(event) {    this.setState({own_digital: event.target.value});  }\n  handleTargetChange(event) {    this.setState({target_digital: event.target.value});  }\n  handleSubmit(event) {\n    this.pk_action();\n    event.preventDefault();\n  }\n\n  async action_levelup(){\n    let res = await this._contract.levelup({digital: parseInt(this.state.levelup_target, 10)}, BoatOfGas.toFixed(0), Big(10000000000).mul(TGas).toFixed(0))\n    // alert('own_digital: ' + this.state.own_digital  + ',target_digital: ' + this.state.target_digital);\n    alert(res)\n    window.location.reload()\n  }\n\n  handleLevelUpTargetChange(event) {    this.setState({levelup_target: event.target.value});  }\n\n  levelupSubmit(event) {\n    this.action_levelup();\n    event.preventDefault();\n  }\n\n\n  render() {\n    const content = !this.state.connected ? (\n      <div>Connecting... <span className=\"spinner-grow spinner-grow-sm\" role=\"status\" aria-hidden=\"true\"></span></div>\n    ) : (this.state.signedIn ? (\n      <div>\n        <div className=\"float-right\">\n          <button\n            className=\"btn btn-outline-secondary\"\n            onClick={() => this.logOut()}>Log out</button>\n        </div>\n        <h4>Hello, <span className=\"font-weight-bold\">{this.state.accountId}</span>!</h4>\n\n        <form onSubmit={this.levelupSubmit}>\n          <label> digital: <input type=\"text\" style={{marginLeft:\"74px\"}} value={this.state.levelup_target} onChange={(event) => {this.handleLevelUpTargetChange(event)}} /> </label><br/>\n          <input type=\"submit\" value=\"levelup\" />\n        </form>\n        <hr></hr>\n        <form onSubmit={this.handleSubmit}>\n          <label> challenger: <input type=\"text\" style={{marginLeft:\"44px\"}} value={this.state.own_digital} onChange={(event) => {this.handleOwnChange(event)}} /> </label><br/>\n          <label> challenge target: <input type=\"text\" value={this.state.target_digital} onChange={(event) => {this.handleTargetChange(event)}} /> </label><br/>\n          <input type=\"submit\" value=\"challenge\" />\n        </form>\n        <hr></hr>\n        <div>\n          Your digitals:\n          <ul>\n            {this.state.digitals.length !== 0 ?\n              (this.state.digitals.map(value => <li key={value}> {value}</li>)) :\n              (<button className=\"btn btn-primary\" onClick={() => this.addFirst()}>Get first digital</button>)}\n          </ul>\n        </div>\n        <hr></hr>\n        <div>\n          Digital Pool:\n          <ul>\n            {this.state.all_digitals.length !== 0 ?\n              (this.state.all_digitals.map(value => <li style={{whiteSpace: \"pre\"}} key={value.digital}> Digital：{value.digital}       Owner：{value.owner}       Level：{value.level}</li>)) :\n              (<div>暂无</div>)}\n          </ul>\n        </div>\n      </div>\n    ) : (\n      <div style={{ marginBottom: \"10px\" }}>\n        <button\n          className=\"btn btn-primary\"\n          onClick={() => this.requestSignIn()}>Log in with NEAR Wallet</button>\n      </div>\n    ));\n    return (\n      <div className=\"px-5\">\n        <h1>Digital War</h1>\n        {content}\n      </div>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}